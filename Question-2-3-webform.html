<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Form validation with messages on top: Code example - Accessibility Developer Guide example</title>
        <meta charset="utf-8">
        <style>
          .control, fieldset {
            margin: 6px 0;
          }
          
          label {
            display: inline-block;
            width: 120px;
            vertical-align: top;
          }
          
          input + label {
            width: auto;
          }
          
          .error, .required {
            color: red;
          }
          
          fieldset ul {
            margin: 0;
          }

          .offscreen {
            position: absolute;
            left: -10000px;
            top: auto;
            width: 1px;
            height: 1px;
            overflow: hidden;
          }
        </style>
    </head>
    <body>
        <h1>Feedback form</h1>
        <form id="feedback-form">
            <div class="control">
                <label for="name">Full name <span class="required">*</span></label>
                <input id="name" name="name" type="text" aria-required="true" aria-describedby="nameHelp" />
                <span id="nameHelp" class="offscreen">This field is required.</span>
            </div>

            <div class="control">
                <label for="biography">Biography</label>
                <textarea id="biography" name="biography" aria-describedby="bioHelp"></textarea>
                <span id="bioHelp" class="offscreen">Include examples on your skills in JavaScript.</span>
            </div>
        
            <!-- Improved Gender Selection with validation -->
            <fieldset class="control" aria-required="true">
                <legend>Gender <span class="required">*</span></legend>
                <div>
                    <input id="gender_male" name="gender" type="radio" value="male" />
                    <label for="gender_male">Male</label>
                </div>
                <div>
                    <input id="gender_female" name="gender" type="radio" value="female" />
                    <label for="gender_female">Female</label>
                </div>
                <span id="genderHelp" class="offscreen">Please select a gender. This field is required.</span>
            </fieldset>
        
            <div class="control">
                <input id="accept_agbs" name="accept_agbs" type="checkbox" value="1" aria-required="true" aria-describedby="termsHelp" />
                <label for="accept_agbs">I accept the terms and conditions</label>
                <span id="termsHelp" class="offscreen">You must accept the terms and conditions to proceed.</span>
            </div>
        
            <div class="control">
                <input name="validate" type="hidden" value="1" />
                <input type="submit" value="Register" />
            </div>
        </form>
      
        <!-- JavaScript for form validation and accessibility enhancements -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
        <script>
            "use strict";
            (function () {
                var validateInput;

                // Function to validate gender selection
                function validateGender() {
                    var isGenderSelected = $('input[name="gender"]:checked').length > 0;
                    var $errorContainer = $('fieldset.errors ul');
                    var $genderFieldset = $('fieldset[aria-required="true"]');

                    // If no gender is selected, show an error
                    if (!isGenderSelected) {
                        if ($('fieldset.errors').length === 0) {
                            $('form').prepend('<fieldset class="errors"><legend>Errors</legend><ul></ul></fieldset>');
                        }

                        // Create a new error message for the gender field
                        var $error = $('<li><a href="#">Please select your gender.</a></li>');
                        $error.click(function (e) {
                            $('#gender_male').focus();
                            e.preventDefault();
                        });

                        // Append the error to the list if it doesn't already exist
                        if ($errorContainer.find('li:contains("Please select your gender.")').length === 0) {
                            $errorContainer.append($error);
                        }

                        // Set aria-describedby for the gender fieldset
                        $genderFieldset.attr('aria-describedby', 'genderHelp');
                    } else {
                        // If a gender is selected, remove any existing error message
                        $errorContainer.find('li:contains("Please select your gender.")').remove();
                        $genderFieldset.removeAttr('aria-describedby');
                    }

                    return isGenderSelected;
                }

                $(document).ready(function () {
                    $('#feedback-form').on('submit', function (e) {
                        var isGenderValid = validateGender();
                        
                        // Prevent form submission if the gender is not selected
                        if (!isGenderValid) {
                            e.preventDefault();
                        }
                    });
                });
            }).call(void 0);
        </script>
    </body>
</html>
